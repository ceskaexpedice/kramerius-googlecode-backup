#Článek popisující nový koncept práv systému kramerius

= Úvod =

Práva systému Kramerius 4  jsou na rozdíl od bibliografických dat ukládána v servisní 
databázi postgres, ve stejném tabulkovém prostoru jako například tabulky pro správu 
procesů. Datový model zobrazený formou UML diagramu tříd vypadá následovně:

http://kramerius.googlecode.com/svn/wiki/rights/prava-wiki.png

Právo je v databázi vyjádřeno jako  vazba mezi uživatelem (a může se jednat o uživatele nebo skupinu), akcí a 
chráněným objektem. Vazba může být dál “obohacena” o dodatečnou podmínku a parametry dodatečné podmínky. 

Pokud je vazba bez dodatečné podmínky lze to interpretovat následovně: 

*Uživatel má právo provádět akci nad chráněným objektem.* 

Pokud je zde ještě vazba na dodatečnou podmínku, lze to interpretovat jako:

 
*Uživatel má právo provádět akci nad chráněným objektem ale pouze za určitých podmínek.* 

Dále popíšu jednotlivé aktéry vazby.


==Akce==

Akce zde reprezentuje formálně zapsanou opraci, kterou uživatel provadí. Krameriem definované akce jsou následující: 

# *read* - _Akce čti definuje operaci číst data (obrázky)._ Pokud má uživatel práva tuto akci provádět, objeví se mu  velký náhled, vygeneruje PDF nebo zobrazí deepZoom prohlížečka. 
# *import* - _Operace importu dat do fedory._ Pokud má uživatel právo importovat data, může spustit dlouhotrvající proces importu.  
# *reindex* - _Akce reindexace._  Uživatel má právo spustit indexaci a to jak z administrátorského menu tak z kontextového. 
# *convert* - n
# *replicationrights* - n
# *enumerator* - n
# *replikator_periodicals* - n
# *replikator_monographs* - n
# *delete* - n
# *export* - n
# *setprivate, setpublic* - n
# *administrate* - n
# *editor*  - n
# *usersadmin*  - _Akce spouštět editor uživatelů  v superadmin módu (viz dále)._ Uživatel může přes administrátorské menu spouštět editor uživatelů. 
# *userssubadmin* - _Akce spouštět editor v subadmin modu (viz dale)._  Uživatel může přes administrátorské menu spouštět editor uživatelů.



==Uživatelé a skupiny==

Uzivatel se kterým je akce svázána může mít podobu buď uživatele nebo skupiny uživatelů. 
Pokud je právo definováno pro skupinu, zjišťuje se, zda přihlášený uživatel je příslušníkem 
dané skupiny.  

Vazba mezi uživatelem a skpinou je vazba typu M:N. Tedy uživatel může být současně příslušníkem více 
skupin a zároveň skupina má více uživatelů.

Kramerius definuje jednu speciální skupinu *_common_users_*. Ta reprezentuje všechny uživatele.


==Chráněný objekt==

Chráněný objekt reprezentuje entitu, na kterou je akce aplikována. Většinou se jedná o součást repositáře 
fedory (Monografie, Periodikum, Ročník, Výtisk, Stránka...) případně se může jednat o celý repositář. 

Systém práv respektuje dědičnost a tedy právo definováno pro vyšší úroveň, platí  i pro úrovně nižší. 

  

==Dodatečná podmínka a parametry podmínky==

Dodatečná podmínka umožňuje rozhodovat na základě dalších dodatečných kritérií, které jsou známy 
až  při běhu programu (IP adresa, metadata objektu atd..).  Podmínka 
může být definována třídou nebo skriptem. Výsledek vyhodnocení podmínky může mít tři stavy *ANO*, *NE* a *NEVÍM*, kde 
třetí stav nevím se aplikuje v případě, že dodatečná podmínka není schopna rozhodnout a ponechává 
rozhodnutí na "vyšší instanci".  ~~To, jaký z těchto stavů bude vrácen je plně v režíi podmínky.~~ 

Parametry podmínky jsou další potřebné informace pro vyhodnocení pomdmínky. Parametry jsou uživatelsky 
definované.

===Modelový příklad:=== 

http://kramerius.googlecode.com/svn/wiki/rights/prava-scenardefault.png


Obrázek je pořízen z administrátorského rozhraní krameria. Jsou na něm vidět nadefinovaná práva 
pro objekt REPOSITORY a akci read. 

První definice říká, že "jakýkoliv" objekt v repository můžou číst všichni návštěvníci (skupina common_users) za 
dodatečné podmínky, že přichází z adresy 89.102.63.195 a nebo 194.108.205.XXX.  Pokud uživatel nepřichází z této adresy, dodatečná 
podmínka rozhodne stavem NEVIM. - Ponechá rozhodnutí na dalším právu.

Druhá definice je podobná té první, liší se dodatečnou podmínkou. Ta v tomto případě zkoumá metadata a příznak
kramerius4:policy, který obsahuje informaci o veřejnosti resp. neveřejnosti dokumentu.


===Krameriem definované dodatečné podmínky===

# *Pohyblivá zeď* - Podmínka rozhodne stavy ANO nebo NE. Zkoumá metadata dotazovaného objektu, konkrětně rok vydání a dle něj rozhodne. Jako parametr podmínka očekává mezní rok.       
# *Příznak kramerius:policy* - Podmínka rozhodne stavy ANO nebo NE. Zkoumá metadata dotazovaného objektu a rozoduje se podle příznaku kramerius:policy. Pokud obsahuje literal policy:private, pak se jedná o neveřejný dokument, v opačném případě o veřejný.
# *IP Filter benevolentní* - Benevolentní filter rozhodne stavy ANO nebo NEVIM. Zkoumá IP adresy návštěvníků. Jako parametry očekává regulární výrazy oddělěné středníkem. Pokud některá z IP adres vyhovuje některému z patternů zapsaném v parametrech práva, 
vrací stav ANO, v opačném případě vrací stav NEVIM. 
# *IP Filter skriktní*  - Podmínka má stejnou logiku jako ta předchozí  s tím, že rozhodováne stavy ANO nebo NE. Buď povolí přístup nebo zakáže.
 
  

===Řazení práv=== 
  