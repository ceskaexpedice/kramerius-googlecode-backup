#summary Datový model
<wiki:toc max_depth="1" />
Digitální objekty systému Kramerius 4 jsou uloženy v úložišti Fedora Commons ve formátu FOXML 1.1. Popis tohoto formátu je zde: [https://wiki.duraspace.org/display/FCR30/Introduction+to+FOXML].

Kramerius 4 používá zobecněný datový model vycházející z návrhu společnosti Qbizm vytvořeném v rámci proof of concept převodu dat ze struktury Kramerius 3 do úložiště Fedora (dále POC). Dokumentace tohoto původního návrhu je k dispozici zde: [http://digit.lib.cas.cz/index.php?cat=fedora].

Příklad jednoduché monografie ve formátu FOXML pro Kramerius 4 je v sekci Downloads, soubor PrikladFOXML.zip.


=Identifikátor digitálních objektů=
Každý digitální objekt systému Kramerius 4 má jednoznačný identifikátor UUID, generovaný stejným algoritmem, který byl použit v systému Kramerius 3 (tedy UUID version 1, viz [http://tools.ietf.org/html/rfc4122 RFC4122]), doplněný prefixem uuid:, například uuid:0eaa6730-9068-11dd-97de-000d606f5dc6
 

=Datové streamy=
Objekty používají datové streamy navržené v rámci POC, povinné streamy jsou DC, BIBLIO_MODS a RELS_EXT. 

Objekty, které obsahují binární stream IMG_FULL s obrázkem v plném rozlišení, jsou oproti POC rozšířeny o další binární stream IMG_THUMB s miniaturou obrázku (ve formátu JPG se šířkou 128 px) pro zobrazení v souhrnných přehledech a binární stream IMG_PREVIEW se zmenšeným náhledem obrázku (ve formátu JPG se šířkou 512 px)

Další rozšíření oproti POC je standardní datový stream POLICY, který obsahuje přístupová  práva ve formátu XACML - použit pouze u objektů s omezeným přístupem.

Pokud pro digitální objekt existuje donátor, jehož logo má být zobrazeno spolu s titulem,  je uveden jako vazba v RELS-EXT na speciální FO-XML objekt, který obsahuje logo donátora v binárním datovém streamu LOGO.  Tento způsob umožňuje informace automaticky indexovat v RI a navíc je možno snáze přidávat nové donátory. Příklad FOXML objektu donátora (Norské fondy) je v balíčku installation v sekci downloads, soubor donator_norway.xml.


=Hierarchie digitálních objektů=

Dokumenty v původním formátu DTD Kramerius 3 mají hierarchickou stromovou strukturu (typicky monografie/svazek/stránka nebo periodikum/ročník/číslo/stránka). Úložiště Fedora není hierarchické. Každému uzlu původní stromové struktury odpovídá digitální objekt FOXML s příslušným content modelem, jednotlivé objekty jsou do stromové struktury propojeny pomocí RDF vazeb definovaných v datovém streamu RELS-EXT.

==Content modely==

Datová struktura, vycházející z formátu dat Kramerius 3, předpokládá následující content modely:

  * monograph
  * monographunit
  * page
  * internalpart
  * periodical
  * periodicalvolume
  * periodicalitem

Definiční soubory těchto modelů jsou součástí  [http://digit.lib.cas.cz/index.php?cat=fedora POC], aktuální verze jsou součástí balíčku installation v sekci downloads, případně v SVN.

Modely monograph a periodical jsou přiřazeny digitálním objektům, které tvoří kořen stromové struktury jednotlivých dokumentů. Při případném rozšiřování datové struktury Kramerius4 o nové typy objektů je třeba pro každý nový typ definovat odpovídající content model a nový kořenový model přidat do seznamu kořenových modelů, definovaných konfiguračním parametrem fedora.topLevelModels (viz [Instalace])


==RDF vazby==

|| *název vazby* || *namespace* || *RDF:resource* || *poznámka* ||
||hasModel || xmlns:fedora-model="info:fedora/fedora-system:def/model#" || content model || standardní vazba Fedory přiřazující content model ||
||hasUnit ||xmlns:kramerius="http://www.nsdl.org/ontologies/relationships#"|| monographunit|| vazba K4 přiřazující část monografie||
||hasPage ||xmlns:kramerius="http://www.nsdl.org/ontologies/relationships#"|| page|| vazba K4 přiřazující stránku||
||hasVolume ||xmlns:kramerius="http://www.nsdl.org/ontologies/relationships#"|| periodicalvolume|| vazba K4 přiřazující ročník||
||hasItem ||xmlns:kramerius="http://www.nsdl.org/ontologies/relationships#"||periodicalitem|| vazba K4 přiřazující číslo||
||hasIntCompPart|| xmlns:kramerius="http://www.nsdl.org/ontologies/relationships#"|| internalpart|| vazba K4 přiřazující samostatnou část||
||isOnPage ||xmlns:kramerius="http://www.nsdl.org/ontologies/relationships#"||page|| vazba K4 přiřazující stránky k samostatné části||
||hasDonator || xmlns:kramerius="http://www.nsdl.org/ontologies/relationships#"|| donator|| vazba K4 na speciální FOXML objekt s logem případného donátora||
||contract ||xmlns:kramerius="http://www.nsdl.org/ontologies/relationships#"||literal|| identifikátor čísla zakázky||
||handle ||xmlns:kramerius="http://www.nsdl.org/ontologies/relationships#"||literal|| persistentní URL (identifikátor typu handle) ||
||policy ||xmlns:kramerius="http://www.nsdl.org/ontologies/relationships#"||literal|| hodnota "public" nebo "private"||
||itemId ||xmlns:oai="http://www.openarchives.org/OAI/2.0/"||literal|| identifikátor, pod kterým bude objekt zveřejněn v protokolu OAI-PMH, obvykle identický s PID objektu||


=Rozšiřování modelu o nové typy dokumentů=
Digitální objekty v systému Kramerius 4 tvoří obecnou stromovou strukturu s vazbami definovanými  pomocí RDF vazeb, které jsou potomky vazeb fedora:hasPart a fedora:isPartOf. 

Systém lze libovolně rozšiřovat o nové typy objektů přidáním příslušného objektu cmodel s povinnými datovými streamy DC, BIBLIO_MODS a RELS_EXT.  

=Zobrazení loga donátora=

Ikona donátora se u titulu v K4 zobrazuje, pokud je v FOXML daného titulu v datastreamu `RELS-EXT` uvedena RDF vazba `kramerius:hasDonator`. V ukázkové monografii Drobnůstky, která je k dispozici v sekci Downloads na http://code.google.com/p/kramerius/downloads/detail?name=PrikladFOXML.zip, je následující RDF vazba:    

{{{
 <kramerius:hasDonator rdf:resource="info:fedora/donator:norway"/>   
}}}

Cílem této vazby je speciální FOXML objekt ( v tomto případě má PID `donator:norway`), ve kterém je v datastreamu `LOGO` uloženo logo příslušného donátora ve formátu JPG.
Soubor s logem Norských fondů je součástí standardní distribuce K4, najdete jej v souboru `installation-x.x.x.zip` v adresáři fedora.

Chcete-li tedy v K4 zobrazovat ikonu jiných sponzorů, musíte jen  vytvořit podle vzoru `donator:norway` vlastní FOXML soubor s logem sponzora, jeho PID nastavit  například na `donator:mujSponzor` , nainstalovat jej do úložiště Fedora a v titulech, u kterých se má toto logo zobrazovat, doplnit RDF vazbu `<kramerius:hasDonator rdf:resource="info:fedora/donator:mujSponzor"/>`

_Poznámka - import z K3: 
K3 takto obecně ikony donátora nepodporuje, obsahuje jen specifickou podporu pro případ Norských fondů, kde se jejich logo zobrazuje u titulů, které mají v poli CreatorSurname uveden text `***Donator NF***`. Konvertor K3->K4 pro takovéto tituly automaticky přidává do RELS-EXT zmiňovanou vazbu  `<kramerius:hasDonator rdf:resource="info:fedora/donator:norway"/>`. _


=Přehled obsahu streamů DC a RELS_EXT pro jednotlivé typy objektů=

==monograph==

RELS_EXT:
  hasModel
  
  hasUnit

  hasPage

  hasIntCompPart

  hasDonator

  contract (literal)

  handle (literal)

  policy (literal)

DC:
  title

  creator

  publisher

  contributor

  identifier - uuid

  identifier - contract

  identifier - isbn / extid

  identifier - handle

  subject - ddc

  subject - udc

  description

  date

  type
  
  language

  rights


==monographUnit==

RELS_EXT:
  hasModel

  hasPage

  hasIntCompPart

  contract (literal)

  handle (literal)

  policy (literal)

DC:
  title

  creator

  publisher
 
  contributor

  identifier - uuid

  identifier - contract

  identifier - handle

  type

  rights

IMG_FULL, IMG_THUMB, IMG_FULL_ADM, TEXT_OCR, TEXT_OCR_ADM


==monograph internalpart==

RELS_EXT: 
  hasModel

  isOnPage

  handle (literal)

  policy (literal)

DC:
  title

  creator

  contributor

  identifier - uuid

  identifier - handle

  type

  rights


==monograph page==

RELS_EXT: 
  hasModel

  file (literal)

  handle (literal)

  policy (literal)

DC:
  title

  identifier - uuid

  identifier - handle

  type

  rights

IMG_FULL, IMG_THUMB, IMG_FULL_ADM, TEXT_OCR, TEXT_OCR_ADM


==periodical==

RELS_EXT:
  hasModel

  hasVolume

  hasDonator

  handle (literal)

  policy (literal)

DC:
  title

  creator
  
  publisher

  contributor

  identifier - uuid

  identifier - issn

  identifier - handle

  subject - ddc

  subject - udc

  description

  date

  type

  language

  rights


==periodicalvolume==

RELS_EXT:
  hasModel

  hasItem

  hasPage

  hasIntCompPart

  contract (literal)

  handle (literal)

  policy (literal)

DC:
  title

  creator

  publisher

  contributor

  identifier - uuid

  identifier - contract

  identifier - handle

  description

  date

  type

  rights


==periodicalitem==

RELS_EXT:
  hasModel

  hasPage

  hasIntCompPart

  contract (literal)

  handle (literal)

  policy (literal)

DC:
  title

  creator

  publisher

  contributor

  identifier - uuid

  identifier - contract

  identifier - handle

  description

  date

  type
 
  rights

IMG_FULL, IMG_THUMB, IMG_FULL_ADM, TEXT_OCR, TEXT_OCR_ADM


==periodical internalpart==

RELS_EXT: 
  hasModel

  isOnPage

  handle (literal)

  policy (literal)

DC:
  title

  creator

  contributor
  
  identifier - uuid

  identifier - handle

  type

  rights


==periodical page==

RELS_EXT: 
  hasModel

  file (literal)

  handle (literal)

  policy (literal)

DC:
  title

  identifier - uuid

  identifier - handle

  type

  rights

IMG_FULL, IMG_THUMB, IMG_FULL_ADM, TEXT_OCR, TEXT_OCR_ADM
 