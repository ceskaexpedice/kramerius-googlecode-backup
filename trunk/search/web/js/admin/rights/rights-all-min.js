function Right(){this.paramTabs={"create":new ParamsTab("create","createParams",bind(function(){rightContainer.data.param.ident=-1;rightContainer.data.param.shortDesc='';rightContainer.data.param.objects=[];this.rebuildParamsTab();},this)),"edit":new ParamsTab("edit","editParams",bind(function(){$("#usedParams").val(rightContainer.data.param.ident);this.rebuildParamsTab();},this))};}Right.prototype.onUserRadioChange=function(){var rb=$("input:radio:checked");if(rb.val()==="role"){$("#userId").show();$("#userId").val("");}else{$("#userId").hide();}}Right.prototype.onCriteriumChange=function(){var selected=$("select[name='criterium'] option:selected").val();if(selected){this.rebuildParamsTab();$("#rightParamsCreation").show();}else{$("#rightParamsCreation").hide();}rightContainer.data.condition=selected;if(rightContainer.options.criteriums[selected]&&rightContainer.options.criteriums[selected].paramsNecessary){this.rebuildParamsTab();$("#rightParamsCreation").show();}else{$("#rightParamsCreation").hide();}}Right.prototype.onRolesKeyUp=function(elm){var userVal=$(elm).val();rightContainer.data.role=userVal;var narr=map(function(item){if(item.startsWith(userVal)){return item;}else return null;},rightContainer.options.roles);if(narr.length>0){var nhtml="";narr.forEach(function(item){nhtml=nhtml+"<div><a href='javascript:_role_select(\""+item+"\");'>"+item+"</a></div>";});$("#userautocomplete").html(nhtml);$("#userautocomplete").show();}}Right.prototype.roleSelection=function(what){$("#userId").val(what);$("#userautocomplete").hide();rightContainer.data.role=what;}Right.prototype.onPriorityChange=function(){rightContainer.data.priority=$("#priority").val();}Right.prototype.initUI=function(rightContainer){if(!rightContainer.data.justcreated){if(rightContainer.data.role!=='common_users'){$("#roleType").attr("checked","checked");$("#roleType").each(bind(function(elm){this.onUserRadioChange(elm);},this));$("#userId").val(rightContainer.data.role);}if(rightContainer.data.condition){$("#criterium").val(rightContainer.data.condition);}if(rightContainer.options.criteriums[rightContainer.data.condition]&&rightContainer.options.criteriums[rightContainer.data.condition].paramsNecessary){$("#rightParamsCreation").show();$("#params").val(rightContainer.data.param.ident);}$("#tabs").tabs({select:bind(this.onTabChange,this)});if(rightContainer.data.param.ident!=-1){$("#tabs").tabs("select",1);}else{$("#tabs").tabs("select",0);}this.rebuildParamsTab();}}Right.prototype.onTabChange=function(event,ui){var key=$(ui.tab).data("key");this.paramTabs[key].tabSelection();$('input[name=tab]').attr('checked',false);$("#"+key+"-check").attr('checked',true);}Right.prototype.rebuildParamsTab=function(){for(var key in this.paramTabs){this.paramTabs[key].rebuild();}}function ParamsTab(key,paramsDiv,tabSelection){this.paramsDiv=paramsDiv;this.key=key;this.tabSelection=tabSelection||bind(function(){},this);}ParamsTab.prototype.rebuildTable=function(){$("#"+this.paramsDiv+" tr").remove();$(rightContainer.data.param.objects).each(bind(function(i,val){var tr="<tr id='"+i+"'> <td width='100%'>"+val+"</td> <td><a href='javascript:right.paramTabs[\""+this.key+"\"].remove("+i+");' class='ui-icon ui-icon-minus'></a></td> <td> <a href='javascript:right.paramTabs[\""+this.key+"\"].edit("+i+");' class='ui-icon ui-icon-pencil'></a> </td></tr>";$("#"+this.paramsDiv).append(tr);},this));}ParamsTab.prototype.remove=function(index){rightContainer.data.param.objects.rm(index);this.rebuildTable();}ParamsTab.prototype.edit=function(index){var val=rightContainer.data.param.objects[index];new InputTextDialog({label:'Editovana hodnota:',value:val}).open(bind(function(cVal){rightContainer.data.param.objects[index]=cVal;this.rebuildTable();},this));}ParamsTab.prototype.add=function(){new InputTextDialog({label:'Nova hodnota:',value:''}).open(bind(function(cVal){rightContainer.data.param.objects.push(cVal);this.rebuildTable();},this));}ParamsTab.prototype.rebuildLabel=function(){var value=rightContainer.data.param.shortDesc||'Nepojmenovano';$("#"+this.paramsDiv+"Label").text(value);}ParamsTab.prototype.editLabel=function(){new InputTextDialog({label:'Nazev:',value:rightContainer.data.param.shortDesc}).open(bind(function(cVal){rightContainer.data.param.shortDesc=cVal;this.rebuildLabel();},this));}ParamsTab.prototype.rebuild=function(){this.rebuildLabel();this.rebuildTable();}ParamsTab.prototype.onSelectParams=function(){var ident=$("#usedParams").val();var reduced=reduce(function(base,element,status){if(base==null){if(element.ident==ident){return element;}}else return base;},null,rightContainer.options.params);if(reduced){rightContainer.data.param=reduced;}else{rightContainer.data.param.ident=-1;rightContainer.data.param.shortDesc='';rightContainer.data.param.objects=[];}this.rebuild();}function InputTextDialog(options){this.options=options||{title:'#ntitle',label:'',value:''};this.dialog=null;}InputTextDialog.prototype.open=function(okfunc,cancelfunc){if(this.dialog){this.dialog.dialog('open');}else{var items=mapJQuerySelector(function(item){return items;},$("#inputDialog"));if(items||items.length==0){$(document.body).append('<div id="inputDialog"> <strong><label id="inputDialogLabel" forname="fortxt"></label></strong><br><input id="inputDialogTxt" style="width:100%"></input></div>');}this.dialog=$('#inputDialog').dialog({width:400,height:250,modal:true,title:'#title',buttons:{"Ok":bind(function(){if(okfunc)okfunc($("#inputDialogTxt").val());this.dialog.dialog("close");},this),"Cancel":bind(function(){if(cancelfunc)cancelfunc();this.dialog.dialog("close");},this)}});}$("#inputDialogTxt").val(this.options.value);$("#inputDialogLabel").text(this.options.label);this.dialog.dialog("option","title",this.options.title);$('#inputDialog').dialog("option","title",this.options.title);}function ChangePswd(){this.dialog=null;}ChangePswd.prototype.changePassword=function(){var urlForPost="users?action=savenewpswd";var url="inc/admin/_change_pswd.jsp";$.get(url,function(data){if(this.dialog){this.dialog.dialog('open');}else{$(document.body).append('<div id="changePswd">'+'</div>');this.dialog=$('#changePswd').dialog({width:400,height:250,modal:true,title:"",buttons:{"Zmen heslo":function(){if($("#pswd").val()==$("#pswdRepeat").val()){$.post(urlForPost,{nswpd:$("#pswd").val()},function(data,textStatus){if(textStatus=="success"){$("#checkPswdStatus").text('Heslo zmeneno');$("#checkPswdStatus").css('color','black');$(this).dialog("close");$("#changePswd").remove();}else{$("#checkPswdStatus").css('color','red');$("#checkPswdStatus").text(dictionary['rights.changepswd.nochangepswd']);}});}else{$("#checkPswdStatus").css('color','red');$("#checkPswdStatus").text(dictionary['rights.changepswd.notsamepswd']);}},"Close":function(){$(this).dialog("close");$("#changePswd").remove();}}});}$("#changePswd").html(data);$("#changePswd").dialog('option','title',dictionary['rights.changepswd.title']);});}var affectedObjectsRights=new AffectedObjectsRights();function AffectedObjectsRights(){this.dialog=null;this.pids=[];this.securedActionTabs={};this.openedDetails=[];}AffectedObjectsRights.prototype.onChange=function(pid){var npids=[];$("#rightsAffectedObject_selected input:checked").each(function(index,val){var v=$(val).val();npids.push({pid:v,model:''});});this.pids=npids;this.clearTabs(function(tab){return this.url("inc/admin/_display_rights_dialog.jsp?pids=")+"&securedaction="+tab;});}AffectedObjectsRights.prototype.clearTabs=function(retrieveUrlFunction){for(var tab in this.securedActionTabs){this.securedActionTabs[tab].dirty=true;this.securedActionTabs[tab].retrieveUrl=bind(retrieveUrlFunction,this)(tab);}}AffectedObjectsRights.prototype.openDialog=function(pids){this.pids=pids;var url=this.url("inc/admin/_display_objects_dialog.jsp?pids=");$.get(url,bind(function(data){if(this.dialog){this.dialog.dialog('open');}else{$(document.body).append('<div id="affectedObjectRights"></div>')this.dialog=$('#affectedObjectRights').dialog({width:800,height:600,modal:true,title:"#title",buttons:{"Editovat vyber":function(){$(this).dialog("close");},"Close":function(){$(this).dialog("close");}}});}$('#affectedObjectRights').html(data);$('a[href*="rightsAffectedObject"]').each(bind(function(index,elm){var action=$(elm).data('action');if(action){this.securedActionTabs[action]=this.createSecurityActionTab(action,this.url("inc/admin/_display_rights_dialog.jsp?pids=")+"&securedaction="+action);this.securedActionTabs[action].retrieve=this.securedActionTabs[action].retrieveContextContent;}},this));$("#rightsAffectedObject_tabs").tabs({select:bind(function(event,ui){this.changeTab(event,ui);},this)});$("#rightsAffectedObject_tabs").tabs("select",0);},this));}AffectedObjectsRights.prototype.createSecurityActionTab=function(action,url){var securedActionTab=new SecuredActionTab({securedAction:action,retrieveUrl:url,pids:this.pids});securedActionTab.url=bind(this.url,this);return securedActionTab;}AffectedObjectsRights.prototype.url=function(baseUrl,pids){if(!pids)pids=this.pids;return baseUrl+"{"+reduce(function(base,item,status){base=base+item.pid.replaceAll(":","\\:")+(status.last?"":";");return base;},"",pids)+"}";}AffectedObjectsRights.prototype.displayDetails=function(id){if($("#"+id).is(':visible')){$("#"+id+"_icon").removeClass('ui-icon ui-icon-triangle-1-s folder');$("#"+id+"_icon").addClass('ui-icon ui-icon-triangle-1-e folder');var index=this.openedDetails.indexOf(id);if(index>=0){this.openedDetails.rm(index);}}else{$("#"+id+"_icon").removeClass('ui-icon ui-icon-triangle-1-e folder');$("#"+id+"_icon").addClass('ui-icon ui-icon-triangle-1-s folder');this.openedDetails.push(id);}$("#"+id).toggle();}AffectedObjectsRights.prototype.changeTab=function(event,ui){var action=$(ui.tab).data("action");if(this.securedActionTabs[action]&&this.securedActionTabs[action].dirty){this.securedActionTabs[action].retrieve();}}function SecuredActionTab(struct){this.dirty=true;this.pids=struct.pids;this.securedAction=struct.securedAction;this.retrieveUrl=struct.retrieveUrl;this.newRightDialog=null;this.globalDeleteDialog=null;this.globalEditDialog=null;this.operation=CREATEOP;}SecuredActionTab.prototype.globalEdit=function(){this.operation=EDITOP;var editUrl=this.url("inc/admin/_display_rights_for_edit.jsp?pids=")+"&action=edit&securedaction="+this.securedAction;$.get(editUrl,bind(function(data){if(this.globalEditDialog){this.globalEditDialog.dialog('open');}else{$(document.body).append('<div id="gDeleteDialog"></div>')this.globalEditDialog=$('#gDeleteDialog').dialog({width:640,height:480,modal:true,title:"#title",buttons:{"Edit":bind(function(){$("#editRights input:checked").each(bind(function(i,val){var arr=$(val).val().split("_");this.editRightForPath(arr[0],arr[1]);},this));this.globalEditDialog.dialog("close");},this),"Close":bind(function(){this.globalEditDialog.dialog("close");},this)}});}$('#gDeleteDialog').html(data);},this));}SecuredActionTab.prototype.globalDelete=function(){this.operation=DELETEOP;var deleteUrl=this.url("inc/admin/_display_rights_for_delete.jsp?pids=")+"&securedaction="+this.securedAction;$.get(deleteUrl,bind(function(data){if(this.globalDeleteDialog){this.globalDeleteDialog.dialog('open');}else{$(document.body).append('<div id="gDeleteDialog"></div>')this.globalDeleteDialog=$('#gDeleteDialog').dialog({width:640,height:480,modal:true,title:"#title",buttons:{"Smazat":bind(function(){var rightIds=[];$("#delRights input:checked").each(function(i,val){rightIds.push($(val).val());});rightContainer={deletedrights:rightIds};this.post();this.globalDeleteDialog.dialog("close");},this),"Close":bind(function(){this.globalDeleteDialog.dialog("close");},this)}});}$('#gDeleteDialog').html(data);},this));}SecuredActionTab.prototype.retrieveContextContent=function(){$("#"+this.securedAction+"_waiting").html("Nacitani...");$.get(this.retrieveUrl,bind(function(data){$('#rightsAffectedObject_'+this.securedAction).html(data);$("#"+this.securedAction+"_waiting").html("");},this));this.dirty=false;}SecuredActionTab.prototype.retrieveGlobalContent=function(){$("#rightsForAction").html(dictionary['administrator.dialogs.waiting']);$.get(this.retrieveUrl,bind(function(data){$("#rightsForAction").html(data);},this));this.dirty=false;}SecuredActionTab.prototype.newRight=function(){this.operation=CREATEOP;var url=this.url("inc/admin/_new_right.jsp?pids=")+"&action=create&securedaction="+this.securedAction;$.get(url,bind(function(data){if(this.newRightDialog){this.newRightDialog.dialog('open');}else{$(document.body).append('<div id="nRightDialog"></div>')this.newRightDialog=$('#nRightDialog').dialog({width:640,height:480,modal:true,title:"#title",buttons:{"Apply":bind(function(){this.post();this.newRightDialog.dialog("close");},this),"Close":bind(function(){this.newRightDialog.dialog("close");},this)}});}$('#nRightDialog').html(data);},this));}SecuredActionTab.prototype.post=function(){var struct=flatten({data:rightContainer.data,affectedObjects:rightContainer.affectedObjects,deletedrights:rightContainer.deletedrights});$.post("rights?action="+this.operation.name,struct,bind(function(){this.retrieve();},this));}SecuredActionTab.prototype.newRightForPath=function(path){this.operation=CREATEOP;var arr=toStringArray(path);var url=this.url("inc/admin/_new_right.jsp?pids=",[{pid:arr[arr.length-1].trim()}])+"&action=create&securedaction="+this.securedAction;$.get(url,bind(function(data){if(this.newRightDialog){this.newRightDialog.dialog('open');}else{$(document.body).append('<div id="nRightDialog"></div>')this.newRightDialog=$('#nRightDialog').dialog({width:640,height:480,modal:true,title:"#title",buttons:{"Apply":bind(function(){this.post();this.newRightDialog.dialog("close");},this),"Close":bind(function(){this.newRightDialog.dialog("close");},this)}});}$('#nRightDialog').html(data);},this));}SecuredActionTab.prototype.editRightForPath=function(rightId,path){this.operation=EDITOP;var arr=toStringArray(path);var url=this.url("inc/admin/_new_right.jsp?pids=",[{pid:arr[arr.length-1].trim()}])+"&action=edit&ids="+rightId+"&securedaction="+this.securedAction;$.get(url,bind(function(data){if(this.newRightDialog){this.newRightDialog.dialog('open');}else{$(document.body).append('<div id="nRightDialog"></div>')this.newRightDialog=$('#nRightDialog').dialog({width:640,height:480,modal:true,title:"...",buttons:{"Apply":bind(function(){this.post();this.newRightDialog.dialog("close");},this),"Close":bind(function(){this.newRightDialog.dialog("close");},this)}});}$('#nRightDialog').html(data);},this));}SecuredActionTab.prototype.deleteRightForPath=function(rightId,path){this.operation=DELETEOP;rightContainer={deletedrights:[rightId]};this.post();}var rightContainer={};var objects={};function toStringArray(str){var nstr=str.substring(1,str.length-1);return nstr.split(',');}function flatten(struct,prefix){var retval={};var processing=[];processing.push({struct:struct,prefix:""});while(processing.length>0){var obj=processing.pop();var cstruct=obj.struct;var cprefix=obj.prefix;for(var item in cstruct){var type=typeof cstruct[item];if(type==="object"){processing.push({struct:cstruct[item],prefix:cprefix+"["+item+"]"});}else if(type==="array"){processing.push({struct:cstruct[item],prefix:cprefix+"["+item+"]"});}else if(type==="function"){}else if(type==="undefined"){}else{retval[cprefix+item]=cstruct[item];}}}return retval;}function GlobalActions(){this.dialog=null;this.actionDialog=null;}GlobalActions.prototype.rigthsForAction=function(action){affectedObjectsRights.securedActionTabs[action]=affectedObjectsRights.createSecurityActionTab(action,"inc/admin/_display_rights_for_global_actions.jsp?pids={uuid\\:1}&securedaction="+action);affectedObjectsRights.securedActionTabs[action].retrieve=affectedObjectsRights.securedActionTabs[action].retrieveGlobalContent;var url="inc/admin/_display_rights_for_global_actions.jsp?pids={uuid\\:1}&securedaction="+action;$.get(url,bind(function(data){if(this.actionDialog){this.actionDialog.dialog('open');}else{var items=mapJQuerySelector(function(item){return items;},$("#rightsForAction"));if(items||items.length==0){$(document.body).append('<div id="rightsForAction"></div>');}this.actionDialog=$('#rightsForAction').dialog({width:640,height:480,modal:true,title:"#title",buttons:{"Close":bind(function(){this.actionDialog.dialog("close");},this)}});}$("#rightsForAction").html(data);},this));}GlobalActions.prototype.globalActions=function(){affectedObjectsRights.pids=[{pid:'uuid:1',model:'REPOSITORY'}];var url="inc/admin/_global_actions.jsp";$.get(url,bind(function(data){if(this.dialog){this.dialog.dialog('open');}else{var items=mapJQuerySelector(function(item){return items;},$("#globalActions"));if(items||items.length==0){$(document.body).append('<div id="globalActions"></div>');}this.dialog=$('#globalActions').dialog({width:640,height:480,modal:true,title:"#title",buttons:{"Close":bind(function(){this.dialog.dialog("close");},this)}});}$("#globalActions").html(data);},this));}var globalActions=new GlobalActions();function Operation(name){this.name=name;}var CREATEOP=new Operation("create");var EDITOP=new Operation("edit");var DELETEOP=new Operation("delete");